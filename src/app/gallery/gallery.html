<div class="gallery-container">
    <app-shop-cart></app-shop-cart>

    <!-- Counters component showing statistics -->
    <div class="gallery-counters-wrapper">
        <app-counters></app-counters>
    </div>

    <!-- Filter Section -->
    <div class="gallery-header">
        <!-- Breadcrumb Navigation -->
        <div class="filter-breadcrumb"
            *ngIf="selectedCategory !== 'All' || selectedContinent !== 'All' || selectedCountry !== 'All'">
            <button class="breadcrumb-btn" (click)="resetFilters()">{{ getTranslation('all') }}</button>
            <span class="breadcrumb-separator" *ngIf="selectedCategory !== 'All'">›</span>
            <button class="breadcrumb-btn" *ngIf="selectedCategory !== 'All'"
                (click)="onCategoryChange(selectedCategory)">
                {{ translateCategory(selectedCategory) }}
            </button>
            <span class="breadcrumb-separator" *ngIf="selectedContinent !== 'All'">›</span>
            <button class="breadcrumb-btn" *ngIf="selectedContinent !== 'All'"
                (click)="onContinentChange(selectedContinent)">
                {{ translateContinent(selectedContinent) }}
            </button>
            <span class="breadcrumb-separator" *ngIf="selectedCountry !== 'All'">›</span>
            <span class="breadcrumb-current" *ngIf="selectedCountry !== 'All'">{{ translateCountry(selectedCountry)
                }}</span>
        </div>

        <!-- Category Filter Buttons -->
        <div class="filter-buttons" *ngIf="selectedCategory === 'All'">
            <button *ngFor="let category of categories" [ngClass]="{ active: selectedCategory === category }"
                (click)="onCategoryChange(category)" class="filter-btn">
                {{ translateCategory(category) }}
            </button>
        </div>

        <!-- Continent Filter Buttons -->
        <div class="filter-buttons"
            *ngIf="selectedCategory !== 'All' && selectedContinent === 'All' && continents.length > 0">
            <button *ngFor="let continent of continents" (click)="onContinentChange(continent)" class="filter-btn">
                {{ translateContinent(continent) }}
            </button>
        </div>

        <!-- Country Filter Buttons -->
        <div class="filter-buttons"
            *ngIf="selectedContinent !== 'All' && selectedCountry === 'All' && countries.length > 0">
            <button *ngFor="let country of countries" (click)="onCountryChange(country)" class="filter-btn">
                {{ translateCountry(country) }}
            </button>
        </div>

        <!-- Search Section -->
        <div class="search-container">
            <input type="text" class="search-input" [placeholder]="getTranslation('searchPlaceholder')"
                [(ngModel)]="searchQuery" (input)="onSearchChange(searchQuery)" />
        </div>

        <!-- Results Count -->
        <div class="results-count">
            {{ filteredImages.length }} {{ currentLanguage === 'en' ? 'images found' : 'Bilder gefunden' }}
        </div>
    </div>

    <div *ngIf="isLoading" class="gallery-loading">
        <div class="spinner"></div>
        <div class="loading-text">{{ currentLanguage === 'en' ? 'Loading photos…' : 'Fotos werden geladen…' }}</div>
    </div>

    <!-- Gallery Grid -->
    <div class="gallery-grid" *ngIf="!isLoading">
        <div *ngFor="let image of paginatedImages; let i = index" class="gallery-item">
            <div class="image-wrapper" (click)="openLightbox(image)">
                <img [src]="image.url" [alt]="image.title" class="gallery-image"
                    [attr.loading]="i < 6 ? 'eager' : 'lazy'" [attr.fetchpriority]="i < 6 ? 'high' : 'auto'"
                    decoding="async" />
                <div class="image-overlay">
                    <div class="overlay-content">
                        <h3>{{ getImageTitle(image) }}</h3>
                        <p>{{ translateCountry(image.country) }}</p>
                        <div class="overlay-actions">
                            <button class="gallery-shop-btn" (click)="addToCart(image); $event.stopPropagation()">Add to
                                cart</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pagination -->
    <div class="pagination" *ngIf="!isLoading">
        <button class="pagination-btn prev-btn" (click)="previousPage()" [disabled]="currentPage === 1">
            ←
        </button>

        <button *ngFor="let page of pageNumbers" [ngClass]="{ active: currentPage === page }" (click)="goToPage(page)"
            class="pagination-btn">
            {{ page }}
        </button>

        <button class="pagination-btn next-btn" (click)="nextPage()" [disabled]="currentPage === totalPages">
            →
        </button>
    </div>

    <!-- Lightbox -->
    <div *ngIf="isLightboxOpen" class="lightbox-overlay" (click)="closeLightbox()">
        <div class="lightbox-container" (click)="$event.stopPropagation()">
            <!-- Main Image -->
            <div class="lightbox-main" (touchstart)="onTouchStart($event)" (touchend)="onTouchEnd($event)">
                <!-- Close Button -->
                <div class="lightbox-image-wrapper">
                    <!-- Close Button -->
                    <button class="lightbox-close" (click)="closeLightbox()">
                        ✕
                    </button>

                    <img *ngIf="currentLightboxImage" [src]="currentLightboxImage.url"
                        [alt]="currentLightboxImage.title" class="lightbox-image" #lightboxImg />

                    <!-- Navigation Buttons -->
                    <button class="lightbox-nav lightbox-nav-prev" (click)="previousLightboxImage()"
                        *ngIf="filteredImages.length > 1">
                        ← {{ currentLanguage === 'en' ? 'Back' : 'Zurück' }}
                    </button>
                    <button class="lightbox-nav lightbox-nav-next" (click)="nextLightboxImage()"
                        *ngIf="filteredImages.length > 1">
                        {{ currentLanguage === 'en' ? 'Next' : 'Weiter' }} →
                    </button>
                </div>

                <div class="lightbox-info" *ngIf="currentLightboxImage">
                    <h2>{{ getImageTitle(currentLightboxImage) }}</h2>
                    <p>{{ translateCountry(currentLightboxImage.country) }}</p>
                    <button class="lightbox-purchase" (click)="addToCart(currentLightboxImage)">Add to cart</button>
                    <span class="lightbox-counter">
                        {{ currentLightboxImageIndex + 1 }} / {{ filteredImages.length }}
                    </span>
                </div>

                <!-- Keyboard Help -->
                <div class="lightbox-help">
                    <span>{{ currentLanguage === 'en' ? 'Use' : 'Nutze' }} <kbd>A</kbd> / <kbd>←</kbd> {{
                        currentLanguage
                        === 'en' ? 'to go back' : 'um zurückzugehen' }} • <kbd>D</kbd> / <kbd>→</kbd> {{ currentLanguage
                        ===
                        'en' ? 'to go next' : 'um weiterzugehen' }} •
                        <kbd>ESC</kbd> {{ currentLanguage === 'en' ? 'to close' : 'zum Schließen' }}</span>
                </div>
            </div>
        </div>
    </div>
</div>